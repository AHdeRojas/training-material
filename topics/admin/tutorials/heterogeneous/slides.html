<!DOCTYPE html>
<html>









  <head>
    <meta charset="utf-8">
    <title>Using Heterogeneous compute resources</title>
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-45719423-18' , 'auto');
        ga('send', 'pageview');
    </script>
    
    <link rel="stylesheet" href="/training-material/assets/css/slides.css">
    <link rel="stylesheet" href="/training-material/assets/css/font-awesome.css" id="theme">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

    
    
    
    
    <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:title" content="Galaxy Training: Using Heterogeneous compute resources" />
    <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    <script type="application/ld+json">
      


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Using Heterogeneous compute resources",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "/blob//LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "courseCode": "admin / heterogeneous / slides",
  "learningResourceType": "slides",
  "name": "Slides for 'Using Heterogeneous compute resources' tutorial",
  "isPartOf": {
    "@type": "Course",
    "name": "Using Heterogeneous compute resources",
    "description": "Using Heterogeneous compute resources",
    "learningResourceType": "tutorial",
    "interactivityType": "expositive",
    "provider": {
      "@type": "Organization",
      "email": "galaxytrainingnetwork@gmail.com",
      "name": "Galaxy Training Network",
      "url": "https://galaxyproject.org/teach/gtn/"
    }
  },
  "url": "https://galaxyproject.github.io//training-material/topics/admin/tutorials/heterogeneous/slides.html",
  "description": "Using Heterogeneous compute resources",
  "hasPart": [

  ],
  "mentions": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://galaxyproject.github.io//training-material/topics/admin/"
    }
  ]
}
    </script>
  </head>
  <body>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse

<div class="my-header"><span>
<a href="/training-material/topics/admin" title="Return to topic page" ><i class="fa fa-level-up" aria-hidden="true"></i></a>

<a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/admin/tutorials/heterogeneous/slides.html"><i class="fa fa-pencil" aria-hidden="true"></i></a>

</span></div>

<div class="my-footer"><span>

<img src="/training-material/assets/images/GTN-60px.png" alt="Galaxy Training Network" style="height: 40px;"/>

</span></div>

---

# Using Heterogeneous compute resources



---

# What are heterogenous compute resources?

Differences in:
- Operating system or version
- Users/groups
- Data accessibility
- Administrative control

Galaxy expects:
- One OS, version (dependencies)
- Shared filesystem w/ fixed paths

---
# Partial solution - CLI job runner

SSH to remote, submit jobs with CLI `sbatch`, `qsub`, etc.

Still depends on shared FS

---
# Pulsar

Galaxy's remote job management system

Can run jobs on any(?) OS including Windows

Multiple modes of operation for every environment

---
# Pulsar - Architecture

Pulsar server runs on remote resource (e.g. cluster head node)

Galaxy Pulsar job runner is Pulsar client

Transport is HTTP or AMQP, language is JSON

---
# Pulsar Transports - RESTful

Pulsar server listens over HTTP(S)

Pulsar client initiates connections to server

Good for:
- Environments where firewall, open ports are not concerns
- No external dependencies (AMQP server)

---
# Pulsar Transports - AMQP

Pulsar server and client connect to AMQP server

Good for:
- Firewalled/NATted remote compute
- Networks w/ bad connectivity

---
# Pulsar Transports - Embedded

Galaxy runs Pulsar server internally

Good for:
- Manipulating paths
- Copying input datasets from non-shared filesystem

---
# Pulsar - Job file staging

Pulsar can be configured to *push* or *pull* when using RESTful:
- Push
  - Galaxy sends job inputs, metadata to Pulsar over HTTP
  - Upon completion signal from Pulsar, Galaxy pulls from Pulsar over HTTP
- Pull
  - Upon setup signal, Pulsar pulls job inputs, metadata from Galaxy over HTTP
  - Upon completion, Pulsar pushes to Galaxy over HTTP

Pulsar can use libcurl for more robust transfers with resume capability

AMQP is pull-only because Pulsar does not run HTTP server

---
# Pulsar - Dependency management

Pulsar does not provide Tool Shed tool dependency management. But:
- It has its own dependency resolver config
- It can auto-install conda dependencies
- In many cases you can copy TS dependencies and adjust `env.sh` with `sed`
  - If the Galaxy server OS &lt;= remote OS

---
# Pulsar - Job management

Pulsar &quot;managers&quot; provide job running interfaces:
- `queued_python`: Run locally on the Pulsar server
- `queued_drmaa`: Run on a cluster with DRMAA
- `queued_cli`: Run on a cluster with local `qsub`, `sbatch`, etc.
- `queued_condor`: Run on HTCondor

---
# Exercise

[Running jobs on remote resources using Pulsar](https://github.com/galaxyproject/dagobah-training/blob/2018-oslo/sessions/17-heterogenous/ex1-pulsar.md)


---

## Thank you!

This material is the result of a collaborative work. Thanks the [Galaxy Training Network](https://wiki.galaxyproject.org/Teach/GTN) and all the contributors  ([Nate Coraor](/training-material/hall-of-fame#natefoo)) !


<img src="/training-material/assets/images/GTN.png" alt="Galaxy Training Network" style="height: 100px;"/>



.footnote[Found a typo? Something is wrong in this tutorial? <br/>Edit it on [GitHub](https://github.com/galaxyproject/training-material/tree/master/topics/admin/tutorials/heterogeneous/slides.html)]

    </textarea>
    <script src="/training-material/assets/js/remark-latest.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({navigation: {scroll: false,}});
      var hljs = remark.highlighter.engine;
    </script>
  </body>
</html>
