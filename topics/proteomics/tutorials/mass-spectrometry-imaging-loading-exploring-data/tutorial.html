<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Mass spectrometry imaging 1: Loading and exploring MSI data</title>
        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-45719423-18' , 'auto');
            ga('send', 'pageview');
        </script>
        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <link rel="stylesheet" href="/training-material/assets/css/font-awesome.css">
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Training material for proteomics workflows in Galaxy" />
        <meta property="og:title" content="Galaxy Training: Mass spectrometry imaging 1: Loading and exploring MSI data" />
        <meta property="og:description" content="Training material for proteomics workflows in Galaxy" />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body>
        





<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/proteomics" title="Go back to list of tutorials">
                            <i class="fa fa-folder-o" aria-hidden="true"></i><span class="visually-hidden">topic</span> Proteomics
                        </a>
                    </li>

                    
                    
                    

                    
                        
                    

                    
                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
                                <i class="fa fa-cog" aria-hidden="true"></i><span class="visually-hidden">instances</span> Galaxy Instances
                            </a>
                            <div class="dropdown-menu">
                                
                                    <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/master/topics/proteomics/docker" title="Docker image for this tutorial">
                                        <i class="fa fa-ship" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
                                    </a>
                                
                                
                                
                            </div>
                        </li>
                    

                    

                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://doi.org/10.5281/zenodo.1560645" title="Links to data">
                            <i class="fa fa-files-o" aria-hidden="true"></i><span class="visually-hidden">zenodo_link</span> Input Dataset
                        </a>
                    </li>
                    

                    
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/proteomics#references" title="References">
                            <i class="fa fa-bookmark" aria-hidden="true"></i><span class="visually-hidden">references</span> Literature
                        </a>
                    </li>
                    

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="EN">
                            EN
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                FR
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                JA
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                ES
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                PT
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                AR
                            </a>
                            
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="fa fa-life-ring" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Chat on Gitter">
            Chat on Gitter
        </a>
        <a class="dropdown-item" href="https://biostar.usegalaxy.org/" title="Ask on Biostars">
            Ask questions on Biostars
        </a>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.md">
                            <i class="fa fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
   
{
  "@context": "http://schema.org",
  "@type": "CreativeWork",
  "name": "Mass spectrometry imaging 1: Loading and exploring MSI data",
  "accessModeSufficient": "visual",
  "accessibilityControl": "fullMouseControl",
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "https://github.com/galaxyproject/training-material/blob/master/LICENSE.md",
  "learningResourceType": "",
  "url": "/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.html",
  "mentions": [
    {
      "@type": "Thing",
      "url": "https://doi.org/10.5281/zenodo.1560645",
      "name": "Training data for Mass spectrometry imaging 1: Loading and exploring MSI data tutorial"
    }
  ],
  "timeRequired": "PT30M",
  "contributor": [
    {
      "@type": "Person",
      "name": "foellmelanie"
    },
    {
      "@type": "Person",
      "name": "bgruening"
    }
  ],
  "description": "The questions this  addresses are:\n - How to upload an imzML file into Galaxy\n - Getting an overview of the MSI data with the MSI quality report tool\n - How to export MSI data as tabular files\n\n\\nThe objectives are:\n - Basic understanding of handling and exploring an imzML file in Galaxy\n\n"
}

    </script>
    <section class="tutorial">
        <h1>Mass spectrometry imaging 1: Loading and exploring MSI data</h1>

        <blockquote class="overview">
            <h3>Overview</h3>

            <strong><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            <li>How to upload an imzML file into Galaxy</li>
            
            <li>Getting an overview of the MSI data with the MSI quality report tool</li>
            
            <li>How to export MSI data as tabular files</li>
            
            </ul>

            <strong><i class="fa fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li>Basic understanding of handling and exploring an imzML file in Galaxy</li>
            
            </ul>

            
            <strong><i class="fa fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

            
            </ul>
            

            
            <p><strong><i class="fa fa-hourglass-end" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 30 minutes</p>
            
        </blockquote>

        <h1 class="no_toc" id="introduction">Introduction</h1>

<p>This tutorial introduces the handling of the mass spectrometry imaging (MSI) file type imzML in Galaxy and some first steps to explore the data.</p>

<p>Mass spectrometry imaging is applied to measure the spatial distribution of biomolecules such as peptides, proteins, metabolites or chemical compounds.
Depending on the analyte of interest, different ionization sources and mass analyzers are used in the mass spectrometer.
Traditionally, the resulting MSI data is exported in the file format of the mass spectrometry vendor. With the introduction of the common standard format imzML, more and more vendors provide an imzML export option and further software exists to convert proprietary files into an imzML file.
The imzML file format was introduced to ease the exchange of MSI data between different instruments and data analysis software <a href="https://doi.org/10.1016/j.jprot.2012.07.026">Schramm et al., Journal of Proteomics, 2012</a>.
Galaxy also supports the <code class="highlighter-rouge">Analyze7.5</code> data format, that is used by ABSciex mass spectrometers.
Independent of the file type all MSI data experiments contain full mass spectra consisitng of mass over charge (m/z) - intensity pairs. Each spectrum has x- and y-coordinates that define the pixel in which it was measured. Often thousands of spectra with hundrets of m/z features are acquired leading to big and complex data.
Before starting with the data analysis it is therefore helpful to visualize all levels of the data in different ways to better understand the data and to obtain an idea about it’s quality and usefulness.</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will deal with:</p>

<ol id="markdown-toc">
  <li><a href="#uploading-an-imzml-file-into-galaxy" id="markdown-toc-uploading-an-imzml-file-into-galaxy">Uploading an imzML file into Galaxy</a></li>
  <li><a href="#exploring-msi-data-with-the-msi-quality-report-tool" id="markdown-toc-exploring-msi-data-with-the-msi-quality-report-tool">Exploring MSI data with the MSI quality report tool</a></li>
  <li><a href="#exporting-msi-data-to-tabular-files" id="markdown-toc-exporting-msi-data-to-tabular-files">Exporting MSI data to tabular files</a></li>
</ol>

</blockquote>

<h1 id="uploading-an-imzml-file-into-galaxy">Uploading an imzML file into Galaxy</h1>

<p>In case no direct imzML export is provided by the mass spectrometer software, proprietary files can be converted to imzML files with the tools provided on the following website: <a href="https://ms-imaging.org/wp/imzml/software-tools/">ms-imaging.org</a>.
The imzML file consists of two files: The first file contains the metadata in an XML file and has the extension <code class="highlighter-rouge">.imzML</code>. The second file contains the mass spectra data and is saved as binary file and its extension is <code class="highlighter-rouge">.ibd</code>. To be valid both files must have the same filename before the extension. More information about the imzML file structure can be found here: <a href="https://ms-imaging.org/wp/imzml/data-structure/">ms-imaging.org</a>. Galaxy provides the <code class="highlighter-rouge">composite</code> upload for files consisting of several components.</p>

<p>In this tutorial we will use a dataset obtained from imaging a mouse kidney. To make computation times more suitable for this training, only the m/z range from 1220 - 1625 and a part of the pixels (purple rectangle in figure 1) containing about half of the kidney and one <em>Bombesin</em> spot were kept.</p>

<figure id="figure-1"><img src="../../images/MSI1_mouse_kidney.png" alt="mouse kidney image" title="Mouse kidney sample before mass spectrometry measurement" /><figcaption><span class="figcaption-prefix">Figure 1:</span> Mouse kidney sample before mass spectrometry measurement</figcaption></figure>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-uploading-an-imzml-file"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Uploading an imzML file</h3>

  <ol>
    <li>
      <p><strong>Create a new history</strong> and give it a name.</p>

      <blockquote class="tip">

        <h3 id="tip-tip-create-a-new-history"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Create a new history</h3>

        <ol>
          <li>Click on the <i class="fa fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>
          <li>Click on <strong>Create New</strong></li>
        </ol>
      </blockquote>
    </li>
    <li>Download the imzML data from <a href="https://doi.org/10.5281/zenodo.156064">Zenodo</a> locally:
      <ul>
        <li><a href="https://zenodo.org/record/1560646/files/mouse_kidney_cut.imzML">imzML metadata component</a></li>
        <li><a href="https://zenodo.org/record/1560646/files/mouse_kidney_cut.ibd">mass spectral data component</a></li>
      </ul>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/1560646/files/mouse_kidney_cut.imzML
https://zenodo.org/record/1560646/files/mouse_kidney_cut.ibd
</code></pre></div>      </div>
    </li>
    <li>
      <p>Upload the data on Galax via the <strong>composite</strong> option</p>

      <blockquote class="tip">
        <h3 id="tip-tip-upload-via-the-composite-option"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Upload via the composite option</h3>
        <ul>
          <li>Open the Galaxy Upload Manager (<i class="fa fa fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> on the top-right of the tool panel)</li>
          <li>Click on <strong>Composite</strong> on the top</li>
          <li>Set <strong>Composite Type</strong> to <code class="highlighter-rouge">imzml</code></li>
          <li>Expand the first <strong>Select</strong> button (for the imzML metadata component)</li>
          <li>Select <strong>Choose local file</strong> and the local <code class="highlighter-rouge">mouse_kidney_cut.imzML</code> file</li>
          <li>Paste the link into the text field: <code class="highlighter-rouge">https://zenodo.org/record/1560646/files/mouse_kidney_cut.imzML</code></li>
          <li>Expand the second <strong>Select</strong> button (for the mass spectral data component)</li>
          <li>Select <strong>Choose local file</strong> and the local <code class="highlighter-rouge">mouse_kidney_cut.ibd</code> file</li>
          <li>Press <strong>Start</strong></li>
          <li><strong>Close</strong> the window</li>
        </ul>
      </blockquote>

      <figure id="figure-2"><img src="../../images/MSI1_upload_composite.png" alt="Upload imzML files" title="Upload an imzML file via the composite upload" /><figcaption><span class="figcaption-prefix">Figure 2:</span> Upload an imzML file via the composite upload</figcaption></figure>

      <blockquote class="tip">
        <h3 id="tip-tip-ftp-upload-for-large-files"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: FTP upload for large files</h3>
        <ul>
          <li>In case one subfile is larger than 2 GB the uploading needs to be done via ftp.</li>
          <li>The necessary steps are explained in this tutorial <a href="/training-material/topics/galaxy-data-manipulation/tutorials/get-data/slides.html">Getting data into Galaxy</a></li>
        </ul>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-tip-uploading-an-analyze75-file"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Uploading an Analyze7.5 file</h3>
        <ul>
          <li><code class="highlighter-rouge">Analyze7.5</code> files are also supported by Galaxy.</li>
          <li>The file consists of three components and is therefore uploaded via the ‘composite’ function, analogously to the imzML upload.</li>
          <li>The files to select in the <code class="highlighter-rouge">composite</code> tab are the header file <code class="highlighter-rouge">.hdr</code>, the m/z values file <code class="highlighter-rouge">.t2m</code> and the spectra file <code class="highlighter-rouge">.img</code>.</li>
        </ul>
      </blockquote>
    </li>
  </ol>
</blockquote>

<h1 id="exploring-msi-data-with-the-msi-quality-report-tool">Exploring MSI data with the MSI quality report tool</h1>

<p>Before starting any analysis, it is important to confirm that the quality of the acquired data is sufficient.
Furthermore, knowing the data’s properties is important to choose the right preprocessing steps and parameters.
The MSI quality report tool provides a fast way to obtain plenty of descriptive statistic plots for MSI data.
Internal calibrants or other known, ubiquitous m/z features can further be used to obtain further quality measures, such as m/z accuracies.</p>

<p>Our mouse kidney dataset contains internal calibrants that were sprayed together with the matrix onto the tissue. The used calibrants are <em>Angiotensin I</em>, <em>Substance P</em>,
<em>Fibrinopeptide B</em> and <em>ACTH_18-39</em>. We furthermore spotted <em>Bombesin</em> peptides close to the tissue to monitor the digestion quality with the fold change of digested vs. undigested <em>Bombesin</em>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-running-the-msi-quality-report-tool"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Running the MSI quality report tool</h3>
  <ol>
    <li>Create the tabular file with the m/z values of the internal calibrants:
      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>m/z       name
1296.69    Angiotensin_I
1347.72    Substance_P
1570.68    Fibrinopeptide_B
2465.19    ACTH_18-39
</code></pre></div>      </div>
      <blockquote class="tip">

        <h3 id="tip-tip-creating-a-new-file"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Creating a new file</h3>

        <ul>
          <li>Open the Galaxy Upload Manager</li>
          <li>Select <strong>Paste/Fetch Data</strong></li>
          <li>Paste the file contents into the text field</li>
          <li>From the Settings menu (<i class="fa fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span>) select <strong>Convert spaces to tabs</strong></li>
          <li>Press <strong>Start</strong> and <strong>Close</strong> the window</li>
        </ul>
      </blockquote>
    </li>
    <li>
      <p><strong>Rename dataset</strong> to <code class="highlighter-rouge">Calibrants</code></p>

      <blockquote class="tip">

        <h3 id="tip-tip-rename-a-dataset"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Rename a dataset</h3>
        <ul>
          <li>Click on the <i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>
          <li>In the central panel, change the <strong>Name</strong> field  to <code class="highlighter-rouge">Calibrants</code></li>
          <li>Click the <strong>Save</strong> button</li>
        </ul>
      </blockquote>
    </li>
    <li>Run the <strong>MSI quality report</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="fa fa-file-o" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“MSI data”</em>: <code class="highlighter-rouge">mouse_kidney_cut</code> will be automatically recognized as input file</li>
        <li><em>“Title”</em>: <code class="highlighter-rouge">Mouse kidney introduction tutorial</code></li>
        <li><i class="fa fa-file-o" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“m/z of interest”</em>: Select the <code class="highlighter-rouge">Calibrants</code> tabular file</li>
        <li><em>“Column with m/z values”</em>: <code class="highlighter-rouge">Column: 1</code></li>
        <li><em>“Column with name of m/z values”</em>: <code class="highlighter-rouge">Column: 2</code></li>
        <li><em>“Tabular file contains a header line”</em>: <code class="highlighter-rouge">Yes</code></li>
        <li><em>“Plot fold change of two m/z”</em>: <code class="highlighter-rouge">Insert Plot fold change of two m/z</code></li>
        <li><em>“M/z 1”</em>: <code class="highlighter-rouge">1224.63</code> (digested <em>Bombesin</em>)</li>
        <li><em>“M/z 2”</em>: <code class="highlighter-rouge">1619.89</code> (full length <em>Bombesin</em>)</li>
      </ul>
    </li>
  </ol>
</blockquote>

<p>Open the pdf by clicking on the eye icon (view data) and answer the following questions according to the table on the first page.</p>

<blockquote class="question">
  <h3 id="question-questions"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How many m/z features does the dataset contain?</li>
    <li>Are the spectra in profile mode or centroided?</li>
    <li>What is the median number of peaks per spectrum and how can this number be interpreted?</li>
    <li>How many of the provided Calibrants were valid?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>9013</li>
      <li>Centroided = FALSE means that the data were read in profile mode. The user has to define in every tool if the input data is in profile or centroided mode. The Centroid value reported here corresponds to the choice the user has made in the tool and not by automatic recognition.</li>
      <li>Median # peaks per spectrum: 4158. The quality report tool consideres intensities &gt; 0 as peaks. Before peak picking this means that also noise with small intensities is counted as peak, therefore the number 4158 is not as astonighing anymore and will probably decrease dramatically after peak picking. So far nearly every second m/z value has an intensity &gt; 0 (4158 peaks /9013 m/z values).</li>
      <li>3 Calibrants out of the 4 Calibrants in the tabular files were valid. As we cut the m/z axis for this tutorial, ACTH is outside the m/z range that we kept (1220 - 1625).</li>
    </ol>
  </blockquote>
</blockquote>

<p>The pdf report continous with plots that show the pixel of the sample in an x-y-coordinate grid. As in each pixel one spectrum is acquired, different properties of the mass spectra can be visualized in the pixel image. The help section of the quality report tool describes each plot of the pdf report, the tutorial here will discuss only some plots in more detail.</p>

<h4 id="fold-change-plots">Fold change plots</h4>

<p>On page 4 and 5 there are the fold change plot that can be used to estimate the efficiency of the tryptic digestion. The first plot shows the average mass spectra for the digested and the undigested <em>Bombesin</em> peptide. The blue lines indicate the provided ppm range and the provided m/z value. The spectrum of the digested peptide probably overlaps with another peptide pattern, while the monoisotopic peak of the <em>Bombesin</em> peptide is clear. The average intensity of the full length <em>Bombesin</em> peptide is higher than the one of the digested peptide.
The average intensity is not helpful here, because we only spotted one drop next to the tissue and the intensity fold change in those pixels is important. The previous spectra plot is useful to control the chosen m/z value and ppm range. To obtain the local fold change in each spectrum the intensities in the m/z ranges of both peptides are averaged, the intensity of the first m/z is divided by the intensity of the second m/z and log2 transformed to obtain the log2 fold change. This value is plotted for each spectrum (pixel) and then it is obvious that many spectra in the upper left corner have a log2 fold change &gt; 0. The drop contains also spectra with a log2 fold change smaller 0 but larger than -5, what indicates that in these spectra less than half of the <em>Bombesin</em> was digested. With the used amounts of spotted <em>Bombesin</em> and sprayed <em>trypsin</em> the log2 fold changes indicate sufficient (but not ideal) digestion.</p>

<figure id="figure-3"><img src="../../images/MSI1_foldchange.png" alt="Fold Change" title="Avererage mass spectra and log2 fold change for Bombesin and its digested peptide" /><figcaption><span class="figcaption-prefix">Figure 3:</span> Avererage mass spectra and log2 fold change for Bombesin and its digested peptide</figcaption></figure>

<h4 id="calibrant-heatmaps">Calibrant heatmaps</h4>

<p>Starting from page 6 for each calibrant an intensity heatmap is plotted. The colour code shows the intensity of the m/z value that is closet to the input m/z value and within the given ppm range. The input m/z value and its name are printed on top of the image, the m/z number in the image shows the closest m/z value, so the m/z value which intensites are plotted in the heatmap. Low <em>Angiotensin</em> intensities occur at the boarder of the <em>Bombesin</em> spot and at the kidney boarder and on some spots in the kidney. In general calibrant intensities are higher in the matrix background than on the tissue due to ion suppression effects. <em>Substance P</em> shows also ion suppression in the <em>Bombesin</em> spot. The heatmap shows no intensity gradient what indicates that spraying of calibrants and matrix was homogeneous.</p>

<figure id="figure-4"><img src="../../images/MSI1_angiotensin_image.png" alt="Angiotensin heatmap" title="Intensity heatmap of Angiotensin I" /><figcaption><span class="figcaption-prefix">Figure 4:</span> Intensity heatmap of Angiotensin I</figcaption></figure>

<blockquote class="tip">
  <h3 id="tip-tip-plotting-heatmaps"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Plotting heatmaps</h3>
  <ul>
    <li>The <strong>MSI mz images</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool allows to generate heatmaps with options such as contrast enhancement and smoothing functions.</li>
  </ul>
</blockquote>

<h4 id="number-of-peaks-and-tic-images">Number of peaks and TIC images</h4>

<p>On page 9 and 10 the number of peaks and the total ion chromatogram (TIC) are plotted per spectrum.</p>

<p>The number of peaks is defined as intensity &gt; 0 what means that before peak picking also noise with intensity &gt; 0 is counted in. Therefore the number of peaks is not much higher in the tissue compared to the background matrix, but this should change after peak picking.</p>

<p>The TIC is the sum of all intensities of one spectrum. Therefore with more peaks in one spectrum the TIC should also be higher. due to their low intensities, noise peaks contribute less to TICs than real peaks, but with the large amount of noise we have in our data, this of course sums also up (4158 peaks per spectrum but we expect only a few hundret peaks with our MS).</p>

<p>Both plots are helpful to decide if TIC normalization can be performed, as TIC normalization assumes that the number of peaks per spectrum are the same in all spectra (QUELLE).</p>

<figure id="figure-5"><img src="../../images/MSI1_npeaks_TIC.png" alt="Npeaks and TIC heatmap" title="Number of peaks and TIC per spectrum" /><figcaption><span class="figcaption-prefix">Figure 5:</span> Number of peaks and TIC per spectrum</figcaption></figure>

<p>Both plots can also serve to check for spraying gradients or reduced machine performance during acquisition time. The mouse kidney was measured from bottom to top (plot on page 2), the performance over time can be easier spotted in the upper plots on page 14 and 15, where the x axis represents the spectra in the order they were measured.</p>

<h4 id="mass-spectra-and-mz-error">Mass spectra and m/z error</h4>

<p>From page 18 on, average mass spectra plots for each (valid) calibrant are plotted (A). Three different m/z scales are used and in one spectrum each blue dot indicates one data point. The theoretical <em>Angiotensin</em> I m/z (1296.69 - dashed blue line) is higher than the maximum of the peak (red line). There is no m/z value with exact m/z value of <em>Angiotensin I</em> (1296.69) but a close m/z value that is 1296.6776 (green line).</p>

<figure id="figure-6"><img src="../../images/MSI1_mz_error.png" alt="mz error" title="m/z error plots" /><figcaption><span class="figcaption-prefix">Figure 6:</span> m/z error plots</figcaption></figure>

<blockquote class="tip">
  <h3 id="tip-tip-plotting-mass-spectra"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Plotting mass spectra</h3>
  <ul>
    <li>The <strong>MSI plot spectra</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool allows to generate different mass spectra plots:</li>
    <li>For single pixels, average spectra for the complete file or pixels of interest</li>
    <li>With different m/z axis ranges (zoom function)</li>
  </ul>
</blockquote>

<p>Figure D) The average plots already give a good estimation about the m/z error, but the error of each spectrum should also be considered. For this dataset a shift over time can be seen: At the beginning of the measurement the spectra had m/z errors up to 50 ppm for Fibrinopeptide B and during measurement the m/z error changed to -100ppm. This indicates that the dataset has to be binned or aligned with 150 ppm tolerance to ensure that the same peptides get a common m/z value.</p>

<h1 id="exporting-msi-data-to-tabular-files">Exporting MSI data to tabular files</h1>

<p>The data from the imzMl file format is not directly readable, therefore special tools are needed to extract information. The <strong>MSI data exporter</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> provides the option to export spectra, feature and intensity data from imzML files as tabular files. The underlaying values of the quality report can be found in the tabular files and allow to follow up on interesting aspects seen in quality report plots. Furthermore, tabular files are compatible with most software for statistical analysis and to generate plots. The intensity matrix of an unprocessed file might be huge as all pixels and all m/z values are stored in the file - the intensity matrix is often more helpful after preprocessing and filtering of the data. Despite preprocessing and filtering, the output tabular files are often too large for visual inspection. Galaxy offers many different text manipulation tools that are helpful to sort and filter such large tabular files. &gt; To find the m/z value that has the highest mean intensity over all pixels, the data can be sorted on the column with the mean intensities:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-export-and-explore-information-from-msi-data"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Export and explore information from MSI data</h3>

  <ol>
    <li>Run <strong>MSI data exporter</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="fa fa-file-o" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“MSI data”</em>: <code class="highlighter-rouge">mouse_kidney_cut</code></li>
        <li><em>“Multiple output files can be selected”</em>: <code class="highlighter-rouge">mz feature output</code> and <code class="highlighter-rouge">pixel output</code></li>
      </ul>
    </li>
    <li>Run <strong>Sort data in ascending or descending order</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="fa fa-file-o" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Sort Query”</em>: <code class="highlighter-rouge">MSI data exporter on data 1: features</code> (output of <strong>MSI data exporter</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>“Number of header lines”</em>: <code class="highlighter-rouge">1</code></li>
        <li><em>“on column”</em>: <code class="highlighter-rouge">column: 3</code></li>
        <li><em>“in”</em>: <code class="highlighter-rouge">descending order</code></li>
        <li><em>“Flavor”</em>: <code class="highlighter-rouge">general numeric sort</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>The m/z values with the highest mean intensities over all pixels are the monoisotopic peaks and isotopic peaks of the calibrant
Substance P with some ppm errors because the data was not yet binned or aligned.</p>

<blockquote class="question">
  <h3 id="question-questions-1"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How many spectra does the dataset contain?</li>
    <li>How many numeric properties does the m/z feature output contain?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-1"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>1581 - The pixel output file has 1582 lines, every line contains the information of one spectrum, but the first line is a header line (click on dataset “MSI data exporter on data 1: spectra” in the history, the line number of the file is written below the dataset name)</li>
      <li>7 - The feature file has 8 columns and except for the mz_names, all columns contain numeric properties, that can be used for further calculations.</li>
    </ol>
  </blockquote>
</blockquote>

<h1 class="no_toc" id="conclusion">Conclusion</h1>


        
        <blockquote class="key_points">
            <h3><i class="fa fa-key" aria-hidden="true"></i><span class="visually-hidden">keypoints</span> Key points</h3>

            <ul>
                
                <li>imzML (continuous or processed file type) and Analyze7.5 can be uploaded into Galaxy via the composite upload.</li>
                
                <li>The MSI quality report should be applied several times during the analysis, especially to control that the preprocessing is going well.</li>
                
                <li>The MSI data exporter can be used any time during the analysis when it is necessary to dig deeper into the data. Galaxy provides many text manipulation tools that can directly be applied on the exported tabular file to filter, sort, plot, ... the data.</li>
                
            </ul>
        </blockquote>
        

        
        <h1>Useful literature</h1>
        <p>Further information, including links to documentation and original publications, regarding the tools, analysis techniques and the interpretation of results described in this tutorial can be found <a href="/training-material/topics/proteomics#references">here</a>.</p>
        

        <h3><i class="fa fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        

        <hr>
        <br>

        <iframe class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Mass spectrometry imaging 1: Loading and exploring MSI data (Proteomics)">Loading...
        </iframe>

        <blockquote class="feedback">
            <h3><i class="fa fa-comments-o" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Give us even more feedback on this content!</h3>
            <p>To give us more detailed feedback about these materials, please take a moment to fill in the extended <a href="https://docs.google.com/forms/d/e/1FAIpQLSc_GLZRpxZGAL9tN6DA1bE6WkNhmQdXT7B16TpOb-X4YwKUsQ/viewform?entry.1548889262=Mass spectrometry imaging 1: Loading and exploring MSI data (Proteomics)">Feedback Form</a>.</p>
        </blockquote>
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Björn Grüning, Melanie Foell)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.md">GitHub</a>.
        </p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
</html>
